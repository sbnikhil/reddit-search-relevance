.PHONY: install test lint clean docker-build docker-up docker-down train evaluate export

install:
	pip install -r requirements.txt

test:
	pytest tests/ -v --cov=. --cov-report=html

lint:
	flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics
	black --check .

format:
	black .

clean:
	find . -type d -name __pycache__ -exec rm -rf {} +
	find . -type f -name "*.pyc" -delete
	rm -rf .pytest_cache htmlcov .coverage

docker-build:
	docker-compose build

docker-up:
	docker-compose up -d

docker-down:
	docker-compose down

docker-logs:
	docker-compose logs -f

train:
	PYTHONPATH=. python scripts/train_ranker.py

evaluate:
	PYTHONPATH=. python scripts/evaluate.py

export:
	PYTHONPATH=. python scripts/export_to_onnx.py

ingest:
	PYTHONPATH=. python scripts/ingest_to_solr.py

streamlit:
	streamlit run streamlit_app.py

create-samples:
	PYTHONPATH=. python scripts/create_sample_data.py

ingest-samples:
	PYTHONPATH=. python scripts/ingest_to_solr.py

demo-setup: create-samples train export
	@echo "âœ… Demo setup complete! Run: make streamlit"

help:
	@echo "Available commands:"
	@echo "  make install      - Install Python dependencies"
	@echo "  make test         - Run tests with coverage"
	@echo "  make lint         - Check code quality"
	@echo "  make format       - Format code with black"
	@echo "  make clean        - Remove cache files"
	@echo "  make docker-build - Build Docker images"
	@echo "  make docker-up    - Start all services"
	@echo "  make docker-down  - Stop all services"
	@echo "  make train        - Train the model"
	@echo "  make evaluate     - Run evaluation"
	@echo "  make export       - Export model to ONNX"
	@echo "  make ingest       - Ingest data to Solr"
	@echo "  make streamlit    - Run Streamlit app"
	@echo "  make create-samples - Generate synthetic demo data"
	@echo "  make demo-setup   - Complete demo setup (samples + train + export)"
